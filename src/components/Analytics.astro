---
interface Props {
  id?: string;
  provider?: 'gtag' | 'gtm' | 'plausible';
}

const { id = import.meta.env.PUBLIC_GA_ID || '', provider = 'gtag' } = Astro.props;

const domain = import.meta.env.PUBLIC_SITE_URL
  ? new URL(import.meta.env.PUBLIC_SITE_URL).hostname
  : '';
---

{
  id && provider === 'gtag' && (
    <>
      <script async src={`https://www.googletagmanager.com/gtag/js?id=${id}`} />
      <script
        is:inline
        set:html={`
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', '${id}');
    `}
      />
    </>
  )
}

{
  id && provider === 'gtm' && (
    <script
      is:inline
      set:html={`
    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','${id}');
  `}
    />
  )
}

{
  provider === 'plausible' && domain && (
    <script defer data-domain={domain} src="https://plausible.io/js/script.js" />
  )
}
